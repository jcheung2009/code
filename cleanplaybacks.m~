function [playbacks] = cleanplaybacks(batch,playbacklog)
%
% function [playbacks] = mcleanplaybacks(batch,playbacklog)
%
% creates a batch.playback file containing filenames of tutor song playbacks
% based on log file.
%
%

fid=fopen(batch,'r');
fplayback=fopen([batch,'.playback'],'w');
pbid = fopen(playbacklog,'r');

numfiles = mcountfilelines(playbacklog);
pbMtx = zeros(2,numfiles);
index=1;
while (1) % each line in log goes into pbMtx
    pbline=fgetl(pbid);
    if (~ischar(pbline))
        break;
    end
    
    if(isempty(strfind(pbline,'Cleared'))) % if tutor song triggered
        spaceidx = strfind(pbline,' ');
        timestr = pbline(1:spaceidx(1)-1);
        AMPMstr = pbline(spaceidx(1)+1:spaceidx(2)-1);
        datestr = pbline(spaceidx(2)+1:spaceidx(3)-1);
        if(isempty(strmatch('PM',AMPMstr)))
            PM=0;
        else
            PM=1;
        end
        
        dateval = str2num(mdate2datestr(datestr));
        timeval = str2num(mtime2timestr(timestr,PM));
        pbMtx(1,index) = dateval;
        pbMtx(2,index) = timeval;
        index = index+1;
    end   
        
end

while (1) % check against files in batch
    wavfile=fgetl(fid);
    if (~ischar(wavfile))
        break;
    end
    wavdate=str2num(mgetwavdate(wavfile));
    wavtime=sr2n(mgetwavtime(wavfile));
    if(str2num(wavdate) == dateval && abs(str2num(wavtime)-timeval)<4)
        fprintf(fplayback,'%s\n',wavfile);
    end
end

fclose(fid);fclose(fplayback);

return;