function jc_plotmotifsummary2(motif_sal, motif_cond,marker,linecolor,excludewashin)
%plots bar graph of regression values between motif duration and
%pitch/entropy/volume
if iscell(motif_sal)
     tb_sal=[];
    motif = [];
    for i = 1:length(motif_sal)
        tb_sal = [tb_sal; jc_tb([motif_sal{i}(:).datenm]',7,0)];
        motif = [motif motif_sal{i}];
    end
    motif_sal = motif;
end
if iscell(motif_cond)
    tb_cond=[];
    motif = [];
    for i = 1:length(motif_cond)
        tb_cond = [tb_cond; jc_tb([motif_cond{i}(:).datenm]',7,0)];
        motif =[motif motif_cond{i}];
    end
    motif_cond = motif;
end

if ~iscell(motif_sal) 
    tb_sal = jc_tb([motif_sal(:).datenm]',7,0);
end
if ~iscell(motif_cond)
    tb_cond = jc_tb([motif_cond(:).datenm]',7,0);
end
if excludewashin == 1
    ind = find(tb_cond<tb_sal(end)+1800); %exclude first half hour of wash in 
    motif_cond(ind) = [];
end

motifdur_and_pitch = arrayfun(@(x) [x.motifdur x.syllpitch],motif_sal,'UniformOutput',false);
motifdur_and_volume = arrayfun(@(x) [x.motifdur log(x.syllvol)],motif_sal,'UniformOutput',false);
motifdur_and_entropy = arrayfun(@(x) [x.motifdur x.syllent],motif_sal,'UniformOutput',false);
motifdur_and_volume = cell2mat(motifdur_and_volume');
motifdur_and_pitch = cell2mat(motifdur_and_pitch');
motifdur_and_entropy = cell2mat(motifdur_and_entropy');
nsyllables = size(motifdur_and_pitch,2)-1;

motifdur_and_pitch2 = arrayfun(@(x) [x.motifdur x.syllpitch],motif_cond,'UniformOutput',false);
motifdur_and_volume2 = arrayfun(@(x) [x.motifdur log(x.syllvol)],motif_cond,'UniformOutput',false);
motifdur_and_entropy2 = arrayfun(@(x) [x.motifdur x.syllent],motif_cond,'UniformOutput',false);
motifdur_and_volume2 = cell2mat(motifdur_and_volume2');
motifdur_and_pitch2 = cell2mat(motifdur_and_pitch2');
motifdur_and_entropy2 = cell2mat(motifdur_and_entropy2');

%zcore the values
motifdur_and_pitch(:,1) = (motifdur_and_pitch(:,1)-mean(motifdur_and_pitch(:,1)))/std(motifdur_and_pitch(:,1));
motifdur_and_volume(:,1) = (motifdur_and_volume(:,1)-mean(motifdur_and_volume(:,1)))/std(motifdur_and_volume(:,1));
motifdur_and_entropy(:,1) = (motifdur_and_entropy(:,1)-mean(motifdur_and_entropy(:,1)))/std(motifdur_and_entropy(:,1));
motifdur_and_pitch2(:,1) = (motifdur_and_pitch2(:,1)-mean(motifdur_and_pitch2(:,1)))/std(motifdur_and_pitch2(:,1));
motifdur_and_volume2(:,1) = (motifdur_and_volume2(:,1)-mean(motifdur_and_volume2(:,1)))/std(motifdur_and_volume2(:,1));
motifdur_and_entropy2(:,1) = (motifdur_and_entropy2(:,1)-mean(motifdur_and_entropy2(:,1)))/std(motifdur_and_entropy2(:,1));

for i = nsyllables
    motifdur_and_pitch(:,i+1) = (motifdur_and_pitch(:,i+1)-mean(motifdur_and_pitch(:,i+1)))/std(motifdur_and_pitch(:,i+1));
    motifdur_and_volume(:,i+1) = (motifdur_and_volume(:,i+1)-mean(motifdur_and_volume(:,i+1)))/std(motifdur_and_volume(:,i+1));
    motifdur_and_entropy(:,i+1) = (motifdur_and_entropy(:,i+1)-mean(motifdur_and_entropy(:,i+1)))/std(motifdur_and_entropy(:,i+1));
    motifdur_and_pitch2(:,i+1) = (motifdur_and_pitch2(:,i+1)-mean(motifdur_and_pitch2(:,i+1)))/std(motifdur_and_pitch2(:,i+1));
    motifdur_and_volume2(:,i+1) = (motifdur_and_volume2(:,i+1)-mean(motifdur_and_volume2(:,i+1)))/std(motifdur_and_volume2(:,i+1));
    motifdur_and_entropy2(:,i+1) = (motifdur_and_entropy2(:,i+1)-mean(motifdur_and_entropy2(:,i+1)))/std(motifdur_and_entropy2(:,i+1));
end
%check for outliers
fignum = input('figure number for checking outliers:');
figure(fignum);
for i = nsyllables
    h = plot(motifdur_and_pitch(:,1),motifdur_and_pitch(:,i+1),'k.');
    removeoutliers = input('remove outliers (motifdur/pitch or n):','s');
    while removeoutliers == 'm' | removeoutliers == 'p'
        nstd = input('nstd:');
        delete(h);
        if removeoutliers == 'm'
            removeind = jc_findoutliers(motifdur_and_pitch(:,1),nstd);
            motifdur_and_pitch(removeind,:) = [];
        else
            removeind = jc_findoutliers(motifdur_and_pitch(:,i+1),nstd);
            motifdur_and_pitch(removeind,i+1) = NaN;
        end
        plot(motifdur_and_pitch(:,1),motifdur_and_pitch(:,i+1),'k.');
        removeoutliers = input('remove outliers (motifdur/pitch or n):','s');
    end
    delete(h);
    
    h = plot(motifdur_and_volume(:,1),motifdur_and_volume(:,i+1),'k.');
    removeoutliers = input('remove outliers (motifdur/volume or n):','s');
    while removeoutliers == 'm' | removeoutliers == 'p'
        nstd = input('nstd:');
        delete(h);
        if removeoutliers == 'm'
            removeind = jc_findoutliers(motifdur_and_volume(:,1),nstd);
            motifdur_and_volume(removeind,:) = [];
        else
            removeind = jc_findoutliers(motifdur_and_volume(:,i+1),nstd);
            motifdur_and_volume(removeind,i+1) = NaN;
        end
        plot(motifdur_and_volume(:,1),motifdur_and_volume(:,i+1),'k.');
        removeoutliers = input('remove outliers (motifdur/volume or n):','s');
    end
    delete(h);
    
    h = plot(motifdur_and_entropy(:,1),motifdur_and_entropy(:,i+1),'k.');
    removeoutliers = input('remove outliers (motifdur/entropy or n):','s');
    while removeoutliers == 'm' | removeoutliers == 'p'
        nstd = input('nstd:');
        delete(h);
        if removeoutliers == 'm'
            removeind = jc_findoutliers(motifdur_and_entropy(:,1),nstd);
            motifdur_and_entropy(removeind,:) = [];
        else
            removeind = jc_findoutliers(motifdur_and_entropy(:,i+1),nstd);
            motifdur_and_entropy(removeind,i+1) = NaN;
        end
        plot(motifdur_and_entropy(:,1),motifdur_and_entropy(:,i+1),'k.');
        removeoutliers = input('remove outliers (motifdur/entropy or n):','s');
    end
    delete(h);
    
    h = plot(motifdur_and_pitch2(:,1),motifdur_and_pitch2(:,i+1),'k.');
    removeoutliers = input('remove outliers (motifdur/pitch or n):','s');
    while removeoutliers == 'm' | removeoutliers == 'p'
        nstd = input('nstd:');
        delete(h);
        if removeoutliers == 'm'
            removeind = jc_findoutliers(motifdur_and_pitch2(:,1),nstd);
            motifdur_and_pitch2(removeind,:) = [];
        else
            removeind = jc_findoutliers(motifdur_and_pitch2(:,i+1),nstd);
            motifdur_and_pitch2(removeind,i+1) = NaN;
        end
        plot(motifdur_and_pitch2(:,1),motifdur_and_pitch2(:,i+1),'k.');
        removeoutliers = input('remove outliers (motifdur/pitch or n):','s');
    end
    delete(h);

    h = plot(motifdur_and_volume2(:,1),motifdur_and_volume2(:,i+1),'k.');
    removeoutliers = input('remove outliers (motifdur/volume or n):','s');
    while removeoutliers == 'm' | removeoutliers == 'p'
        nstd = input('nstd:');
        delete(h);
        if removeoutliers == 'm'
            removeind = jc_findoutliers(motifdur_and_volume2(:,1),nstd);
            motifdur_and_volume2(removeind,:) = [];
        else
            removeind = jc_findoutliers(motifdur_and_volume2(:,i+1),nstd);
            motifdur_and_volume2(removeind,i+1) = NaN;
        end
        plot(motifdur_and_volume2(:,1),motifdur_and_volume2(:,i+1),'k.');
        removeoutliers = input('remove outliers (motifdur/volume or n):','s');
    end
    delete(h);

    h = plot(motifdur_and_entropy2(:,1),motifdur_and_entropy2(:,i+1),'k.');
    removeoutliers = input('remove outliers (motifdur/entropy or n):','s');
    while removeoutliers == 'm' | removeoutliers == 'p'
        nstd = input('nstd:');
        delete(h);
        if removeoutliers == 'm'
            removeind = jc_findoutliers(motifdur_and_entropy2(:,1),nstd);
            motifdur_and_entropy2(removeind,:) = [];
        else
            removeind = jc_findoutliers(motifdur_and_entropy2(:,i+1),nstd);
            motifdur_and_entropy2(removeind,i+1) = NaN;
        end
        plot(motifdur_and_entropy2(:,1),motifdur_and_entropy2(:,i+1),'k.');
        removeoutliers = input('remove outliers (motifdur/entropy or n):','s');
    end
    delete(h);
end

fignum = input('figure number for plotting bar plot for regression values');
xlocs = input('x locations for plotting bars:');
figure(fignum);

for i = 1:nsyllables
    subtightplot(i,3,1+3*(i-1),0.07,0.04,0.1);hold on;
    pitchcorr = [motifdur_and_pitch(:,1) motifdur_and_pitch(:,i+1)];
    removeind = find(isnan(pitchcorr(:,2)));
    pitchcorr(removeind,:) = [];
    pitchcorr2 = [motifdur_and_pitch2(:,1) motifdur_and_pitch2(:,i+1)];
    removeind = find(isnan(pitchcorr2(:,2)));
    pitchcorr2(removeind,:) = [];
    [hi lo mn1] = jc_BootstrapCI_r(pitchcorr);
    createPatches(xlocs(1),mn1,0.5,'k',0.5);
    plot([xlocs(1) xlocs(1)],[hi lo],'k','linewidth',1);
    [hi lo mn2] = jc_BootstrapCI_r(pitchcorr2);
    createPatches(xlocs(2),mn2,0.5,linecolor,0.5);
    plot([xlocs(2) xlocs(2)],[hi lo],'k','linewidth',1);
    h = findobj(gca,'Type','patch');set(h,'edgecolor','none');
    ylabel('Correlation Coefficient');
    title('Motif duration vs pitch correlation');

    subtightplot(i,3,2+3*(i-1),0.07,0.04,0.1);hold on;
    volcorr = [motifdur_and_volume(:,1) motifdur_and_volume(:,i+1)];
    removeind = find(isnan(volcorr(:,2)));
    volcorr(removeind,:) = [];
    volcorr2 = [motifdur_and_volume2(:,1) motifdur_and_volume2(:,i+1)];
    removeind = find(isnan(volcorr2(:,2)));
    volcorr2(removeind,:) = [];
    [hi lo mn1] = jc_BootstrapCI_r(volcorr);
    createPatches(xlocs(1),mn1,0.5,'k',0.5);
    h = findobj(gca,'Type','patch');set(h,'facealpha',0.5);
    plot([xlocs(1) xlocs(1)],[hi lo],'k','linewidth',1);
    [hi lo mn2] = jc_BootstrapCI_r(volcorr2);
    bar(xlocs(2),mn2,1,'edgecolor','none','facecolor',linecolor);
    h = findobj(gca,'Type','patch');set(h,'facealpha',0.5);
    plot([xlocs(2) xlocs(2)],[hi lo],'k','linewidth',1);
    title('Motif duration vs volume correlation');

    subtightplot(i,3,3+3*(i-1),0.07,0.04,0.1);hold on;
    entcorr = [motifdur_and_entropy(:,1) motifdur_and_entropy(:,i+1)];
    removeind = find(isnan(entcorr(:,2)));
    entcorr(removeind,:) = [];
    entcorr2 = [motifdur_and_entropy2(:,1) motifdur_and_entropy2(:,i+1)];
    removeind = find(isnan(entcorr2(:,2)));
    entcorr2(removeind,:) = [];
    [hi lo mn1] = jc_BootstrapCI_r(motifdur_and_entropy);
    bar(xlocs(1),mn1,1,'edgecolor','none','facecolor','k');
    h = findobj(gca,'Type','patch');set(h,'facealpha',0.5);
    plot([xlocs(1) xlocs(1)],[hi lo],'k','linewidth',1);
    [hi lo mn2] = jc_BootstrapCI_r(motifdur_and_entropy2);
    bar(xlocs(2),mn2,1,'edgecolor','none','facecolor',linecolor);
    h = findobj(gca,'Type','patch');set(h,'facealpha',0.5);
    plot([xlocs(2) xlocs(2)],[hi lo],'k','linewidth',1);
    title('Motif duration vs entropy correlation');
end



